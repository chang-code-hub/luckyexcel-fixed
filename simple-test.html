<!DOCTYPE html>
<html>
<head>
    <title>Simple Test</title>
</head>
<body>
    <h1>Simple LuckyExcel Test</h1>
    <input type="file" id="file" accept=".xlsx">
    <div id="output" style="white-space: pre; font-family: monospace; padding: 20px;"></div>
    
    <script src="dist/luckyexcel.umd.js"></script>
    <script>
        const output = document.getElementById('output');
        
        function log(msg) {
            output.textContent += msg + '\n';
            console.log(msg);
        }
        
        log('Page loaded');
        log('LuckyExcel available: ' + (typeof LuckyExcel !== 'undefined'));
        
        if (typeof LuckyExcel !== 'undefined') {
            log('LuckyExcel methods: ' + Object.keys(LuckyExcel).join(', '));
        }
        
        document.getElementById('file').addEventListener('change', function(e) {
            const file = e.target.files[0];
            log('\n--- File selected: ' + file.name);
            
            if (typeof LuckyExcel === 'undefined') {
                log('ERROR: LuckyExcel not loaded!');
                return;
            }
            
            log('Calling LuckyExcel.transformExcelToUniver...');
            
            try {
                LuckyExcel.transformExcelToUniver(
                    file,
                    function(data) {
                        log('SUCCESS! Data received');
                        log('Sheets: ' + (data.sheetOrder ? data.sheetOrder.length : 'unknown'));
                        
                        // Try to export
                        log('\nTrying export...');
                        LuckyExcel.transformUniverToExcel({
                            snapshot: data,
                            fileName: 'test-export.xlsx',
                            success: function(buffer) {
                                log('Export SUCCESS!');
                                
                                // Create download link
                                const blob = new Blob([buffer], {
                                    type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'
                                });
                                const url = URL.createObjectURL(blob);
                                const a = document.createElement('a');
                                a.href = url;
                                a.download = 'test-export.xlsx';
                                a.textContent = 'Download test-export.xlsx';
                                a.style.display = 'block';
                                a.style.marginTop = '20px';
                                document.body.appendChild(a);
                            },
                            error: function(err) {
                                log('Export ERROR: ' + err.message);
                            }
                        });
                    },
                    function(error) {
                        log('ERROR: ' + error.message);
                        log('Stack: ' + error.stack);
                    }
                );
            } catch (e) {
                log('EXCEPTION: ' + e.message);
                log('Stack: ' + e.stack);
            }
        });
    </script>
</body>
</html>