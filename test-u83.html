<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Test U83 Import</title>
    <script src="./dist/luckyexcel.umd.js"></script>
</head>
<body>
    <h1>Test U83 Import</h1>
    <input type="file" id="fileInput" accept=".xlsx" />
    <pre id="output"></pre>
    
    <script>
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                console.log('Starting import...');
                
                LuckyExcel.transformExcelToUniver(
                    file,
                    function(workbookData) {
                        console.log('Import complete!');
                        
                        // Check U83 and V83 specifically
                        const dcfSheet = workbookData.sheets[Object.keys(workbookData.sheets)[6]];
                        if (dcfSheet && dcfSheet.cellData) {
                            console.log('DCF Sheet name:', dcfSheet.name);
                            
                            const row82 = dcfSheet.cellData[82]; // Row 83 in 0-based
                            if (row82) {
                                console.log('=== Row 83 (0-based: 82) ===');
                                console.log('T83 (col 19):', JSON.stringify(row82[19]));
                                console.log('U83 (col 20):', JSON.stringify(row82[20]));
                                console.log('V83 (col 21):', JSON.stringify(row82[21]));
                                
                                // Also log the actual data
                                document.getElementById('output').textContent = 
                                    'Row 83:\n' +
                                    'T83: ' + JSON.stringify(row82[19], null, 2) + '\n' +
                                    'U83: ' + JSON.stringify(row82[20], null, 2) + '\n' +
                                    'V83: ' + JSON.stringify(row82[21], null, 2);
                            }
                            
                            const row83 = dcfSheet.cellData[83]; // Row 84 in 0-based
                            if (row83) {
                                console.log('=== Row 84 (0-based: 83) ===');
                                console.log('T84 (col 19):', JSON.stringify(row83[19]));
                                console.log('U84 (col 20):', JSON.stringify(row83[20]));
                                console.log('V84 (col 21):', JSON.stringify(row83[21]));
                            }
                        }
                        
                        // Now export it back to Excel
                        LuckyExcel.transformUniverToExcel({
                            snapshot: workbookData,
                            fileName: 'export-test.xlsx',
                            success: function(buffer) {
                                console.log('Export complete!');
                                
                                // Create download link
                                const blob = new Blob([buffer], { 
                                    type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' 
                                });
                                const url = URL.createObjectURL(blob);
                                const a = document.createElement('a');
                                a.href = url;
                                a.download = 'export-test.xlsx';
                                a.click();
                            },
                            error: function(err) {
                                console.error('Export error:', err);
                            }
                        });
                    },
                    function(err) {
                        console.error('Import error:', err);
                    }
                );
            }
        });
    </script>
</body>
</html>